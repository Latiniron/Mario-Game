<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mario Game</title>
  <meta property="og:title" content="Mario Browser Game">
  <meta property="og:description" content="Ein kleines Mario-inspiriertes Browser-Spiel.">
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://latiniron.github.io/Mario-Game/MarioGame.jpg">
  <style>
    /* Farben, inspiriert vom NES-Stil */
    :root{--bg:#78c0ff;--ground:#6b4f2f;--block:#c77f3a;--player:#ffdd57;--enemy:#d9534f;--coin:#ffd700}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);}
    #gameWrap{display:flex;flex-direction:column;align-items:center;padding:12px;position:relative;}
    
    /* Responsive Canvas */
    canvas{
      background:linear-gradient(#78c0ff 0%, #a0e1ff 60%);
      border:6px solid #333;
      border-radius:8px;
      image-rendering:pixelated; 
      width: 100%; 
      max-width: 800px; 
      height: auto;
      touch-action: none; /* VERBESSERT: Verhindert Scrollen/Zoomen im Canvas auf Touch-Geräten */
    }
    
    @media (max-width: 820px) {
        canvas {
            width: 95%;
            height: calc(95vw * 450 / 800);
        }
        #hud {
            width: 95%;
        }
    }

    #hud{width:800px;max-width:95%;display:flex;justify-content:space-between;margin-top:8px;color:#222}
    .btn{padding:6px 10px;border-radius:6px;border:1px solid rgba(0,0,0,0.2);cursor:pointer;background:white}
    #info{font-size:14px}
    .links{max-width:800px;margin-top:12px;color:#222;font-size:13px;display:flex;gap:8px;flex-wrap:wrap}
    .links a{color:#0645ad;text-decoration:none;padding:6px 8px;border-radius:6px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.9)}
    .screenshot{max-width:800px;margin-top:10px;color:#222;font-size:13px;}
    .screenshot img{max-width:100%;border-radius:6px;border:1px solid rgba(0,0,0,0.08)}
    #footerNote{max-width:800px;margin-top:8px;color:#222;font-size:12px;opacity:0.9}

    /* Styles für die virtuellen Touch-Buttons (nur auf Handy sichtbar) */
    #touch-controls {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: none; 
      padding: 15px;
      box-sizing: border-box;
      z-index: 100;
      justify-content: space-between;
      pointer-events: none;
    }

    @media (max-width: 600px) {
      #touch-controls {
        display: flex;
      }
    }

    .touch-btn {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      pointer-events: auto;
      touch-action: manipulation; /* Verbessert: Stellt sicher, dass das Tippen funktioniert */
      border: 3px solid rgba(255, 255, 255, 0.8);
      opacity: 0.8;
    }
    .touch-btn:active {
      opacity: 1.0;
      background: rgba(0, 0, 0, 0.8);
    }

    #jump-btn {
      margin-right: 15px;
    }
    #move-btns {
      display: flex;
      gap: 15px;
      margin-left: 15px;
    }

  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="800" height="450"></canvas>
    <div id="hud">
      <div id="info">Punkte: <span id="score">0</span> • Leben: <span id="lives">3</span></div>
      <div>
        <button id="restart" class="btn">Neu starten</button>
        <button id="fullscreen" class="btn">Vollbild</button>
      </div>
    </div>

    <div class="links">
      <a href="https://github.com/Latiniron/Mario-Game" target="_blank" rel="noopener">Repo</a>
      <a href="https://github.com/Latiniron/Mario-Game/blob/main/README.md" target="_blank" rel="noopener">README.md</a>
      <a href="https://latiniron.github.io/Mario-Game/MarioGame.jpg" target="_blank" rel="noopener">Screenshot</a>
    </div>

    <div class="screenshot">
      <img src="MarioGame.jpg" alt="Mario Game Screenshot" onerror="this.style.display='none'"/>
    </div>

    <div style="max-width:800px;margin-top:10px;color:#222;font-size:13px;">
      Steuerung: ← → oder A/D zum Laufen, Leertaste oder W zum Springen. (Auf Mobilgerät: Virtuelle Tasten).
    </div>

    <div id="footerNote">
      Hinweis: Bild und index.html müssen im Repo-Root liegen. Groß-/Kleinschreibung beachten!
    </div>
  </div>

  <div id="touch-controls">
    <div id="move-btns">
      <div id="left-btn" class="touch-btn">◀</div>
      <div id="right-btn" class="touch-btn">▶</div>
    </div>
    <div id="jump-btn" class="touch-btn">↑</div>
  </div>

  <script>
    // ***************************************************************
    // SCHRITT 1: SPIELVARIABLEN UND SETUP
    // ***************************************************************

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 450;
    
    // Setzt das keys-Objekt für PC- und Mobile-Steuerung
    window.keys = { 
        left: false, 
        right: false, 
        up: false 
    }; 
    
    // Globale Spielvariablen
    let score = 0;
    let lives = 3;
    let gameRunning = false;
    const GRAVITY = 0.8; 
    const JUMP_POWER = -15; 

    // Spieler-Objekt (Mario)
    let player = {
        x: 50,
        y: CANVAS_HEIGHT - 60, 
        width: 25,
        height: 35,
        xSpeed: 0,
        ySpeed: 0, 
        maxSpeed: 5,
        isGrounded: false,
    };
    
    // Die Welt: Ein einfacher Boden
    const groundHeight = 20;
    const ground = {
        x: 0,
        y: CANVAS_HEIGHT - groundHeight,
        width: CANVAS_WIDTH,
        height: groundHeight
    };

    // HUD aktualisieren
    function updateHUD() {
        document.getElementById('score').textContent = score;
        document.getElementById('lives').textContent = lives;
    }

    // ***************************************************************
    // SCHRITT 2: SPIEL-LOGIK (UPDATE)
    // ***************************************************************

    function handleInput() {
        // Horizontale Bewegung
        if (window.keys.left) {
            player.xSpeed = -player.maxSpeed;
        } else if (window.keys.right) {
            player.xSpeed = player.maxSpeed;
        } else {
            // Reibung / Verlangsamen
            player.xSpeed *= 0.8; 
            if (Math.abs(player.xSpeed) < 0.5) player.xSpeed = 0;
        }

        // Sprung
        // WICHTIG: Setzt window.keys.up im nächsten Frame wieder auf false, 
        // damit der Spieler nur einmal springt.
        if (window.keys.up && player.isGrounded) {
            player.ySpeed = JUMP_POWER; 
            player.isGrounded = false;
        }
        // Schlüssel sofort zurücksetzen, damit der Sprung-Tipp-Impuls funktioniert
        if (window.keys.up && !player.isGrounded) {
             window.keys.up = false; 
        }
    }

    function applyGravity() {
        if (!player.isGrounded) {
            player.ySpeed += GRAVITY;
        }
        player.y += player.ySpeed;
        player.x += player.xSpeed;
    }

    function checkCollision() {
        // Kollision mit dem Boden
        const playerBottom = player.y + player.height;
        const groundTop = ground.y;

        if (playerBottom >= groundTop) {
            player.y = groundTop - player.height; 
            player.ySpeed = 0; 
            player.isGrounded = true;
        }
    }

    function update() {
        if (!gameRunning) return;

        handleInput();
        applyGravity();
        checkCollision();
        
        // Spieler an den horizontalen Rändern halten
        if (player.x < 0) player.x = 0;
        if (player.x + player.width > CANVAS_WIDTH) player.x = CANVAS_WIDTH - player.width;
    }

    // ***************************************************************
    // SCHRITT 3: ZEICHNEN (DRAW)
    // ***************************************************************

    function drawGround() {
        ctx.fillStyle = 'var(--ground)'; 
        ctx.fillRect(ground.x, ground.y, ground.width, ground.height);
    }

    function drawPlayer() {
        // Zeichne Mario (ein gelber Block)
        ctx.fillStyle = 'var(--player)'; 
        ctx.fillRect(player.x, player.y, player.width, player.height);
        
        // Kleiner Hut-Simulations-Punkt (Rot)
        ctx.fillStyle = 'red';
        ctx.fillRect(player.x + player.width / 4, player.y - 3, player.width / 2, 5);
    }

    function draw() {
        // 1. Canvas löschen
        ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        
        // 2. Elemente zeichnen
        drawGround();
        drawPlayer();
    }

    // Haupt-Spielschleife
    function gameLoop() {
        if (gameRunning) {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
    }

    // ***************************************************************
    // SCHRITT 4: GAME-CONTROLS UND FUNKTIONEN
    // ***************************************************************

    function startGame() {
        if (gameRunning) return;
        gameRunning = true;
        updateHUD();
        gameLoop();
    }

    /**
     * Setzt das Spiel zurück. FUNKTION FÜR DEN NEUSTART-BUTTON!
     */
    window.restartGame = function() {
        score = 0;
        lives = 3;
        
        // Spieler auf Startposition zurücksetzen
        player.x = 50;
        player.y = CANVAS_HEIGHT - 60;
        player.xSpeed = 0;
        player.ySpeed = 0;
        player.isGrounded = false;
        
        gameRunning = false; // Stoppt den alten Loop
        
        // Tasten-Status zurücksetzen
        window.keys.left = false;
        window.keys.right = false;
        window.keys.up = false;
        
        updateHUD();
        startGame(); // Startet den neuen Loop
    };

    // ***************************************************************
    // SCHRITT 5: EVENT LISTENER (Tastatur und Touch)
    // ***************************************************************

    // Tastatur-Events (PC)
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') window.keys.left = true;
        if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') window.keys.right = true;
        if (e.key === ' ' || e.key.toLowerCase() === 'w') window.keys.up = true; 
    });

    document.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') window.keys.left = false;
        if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') window.keys.right = false;
    });


    // DOM-Lade-Events (Buttons und Touch)
    document.addEventListener('DOMContentLoaded', () => {
        const restartBtn = document.getElementById('restart');
        const fullscreenBtn = document.getElementById('fullscreen');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const jumpBtn = document.getElementById('jump-btn');

        // Neustart Button
        restartBtn.addEventListener('click', window.restartGame);

        // Touch-Funktionen
        function handleTouchStart(controlVariable) {
            window.keys[controlVariable] = true;
        }

        function handleTouchEnd(controlVariable) {
            window.keys[controlVariable] = false;
        }
        
        // Touch-Listener für Bewegung
        leftBtn.addEventListener('pointerdown', () => handleTouchStart('left'));
        leftBtn.addEventListener('pointerup', () => handleTouchEnd('left'));
        leftBtn.addEventListener('pointerleave', () => handleTouchEnd('left'));

        rightBtn.addEventListener('pointerdown', () => handleTouchStart('right'));
        rightBtn.addEventListener('pointerup', () => handleTouchEnd('right'));
        rightBtn.addEventListener('pointerleave', () => handleTouchEnd('right'));
        
        // Touch-Listener für Sprung (wichtig: up muss schnell wieder auf false gesetzt werden)
        jumpBtn.addEventListener('pointerdown', () => {
            handleTouchStart('up');
            // Optimierung: Setzt den Key kurz zurück, um einen schnellen Sprung-Impuls zu gewährleisten
            setTimeout(() => handleTouchEnd('up'), 100); 
        });
        // Auch pointerup/leave verlinken, falls der Nutzer länger drückt
        jumpBtn.addEventListener('pointerup', () => handleTouchEnd('up'));
        jumpBtn.addEventListener('pointerleave', () => handleTouchEnd('up'));
        
        // Verhindert das Standardverhalten des Browsers
        const controlsDiv = document.getElementById('touch-controls');
        controlsDiv.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });


        // Vollbild-Funktion
        fullscreenBtn.addEventListener('click', () => {
             if (canvas.requestFullscreen) {
                canvas.requestFullscreen();
            }
        });

        // Spiel starten!
        startGame();
    });
</script>
</body>
</html>
